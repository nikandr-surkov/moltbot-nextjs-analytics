# Project Structure

```
‚îú‚îÄ‚îÄ üìÅ app
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ api
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ auth
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ route.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ daily
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ route.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ gamble
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ route.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ moltbot
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÑ route.ts
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ globals.css
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ layout.tsx
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ page.tsx
‚îú‚îÄ‚îÄ üìÅ lib
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ db
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ index.ts
‚îÇ       ‚îî‚îÄ‚îÄ üìÑ schema.ts
‚îú‚îÄ‚îÄ üìÑ drizzle.config.ts
‚îú‚îÄ‚îÄ üìÑ next-env.d.ts
‚îú‚îÄ‚îÄ üìÑ next.config.ts
‚îú‚îÄ‚îÄ üìÑ package.json
‚îú‚îÄ‚îÄ üìÑ README.md
‚îî‚îÄ‚îÄ üìÑ tsconfig.json
```

# Code Files

## /README.md

```md
# üé≤ Telegram Gamble & AI Data Analyst with Moltbot (Clawdbot)

A Next.js Telegram Mini App featuring a provably fair gambling game and a **secure, dedicated integration for AI Agents** like Moltbot (Clawdbot).

This project serves as a reference implementation for developers who want to build "AI-Ready" applications. It demonstrates how to expose a **secure, read-only SQL interface** that allows an AI assistant to monitor database performance, track jackpots, and analyze player behavior in real-time without risking data integrity.

## ‚ú® Features

### ü§ñ The AI Analyst (Moltbot/Clawdbot Integration)

* **Dedicated AI Endpoint:** A special route `/api/moltbot` designed specifically for Moltbot (Clawdbot) to execute SQL queries.
* **Strict Security:**
* **Authentication:** Protected by a high-entropy `x-moltbot-secret` header.
* **Read-Only Enforcement:** The API strictly blocks `DROP`, `DELETE`, `UPDATE`, `INSERT`, etc., ensuring the AI cannot accidentally destroy data.


* **Performance Monitoring:** Ask your bot questions like *"What is the win rate for the last hour?"* or *"Show me the top 10 users by balance."*

### üéÆ The Game

* **Telegram Mini App:** Native integration using `@twa-dev/sdk`.
* **Provably Fair Logic:** Simple 1-100 roll mechanics with immediate feedback.
* **Global Jackpot:** A shared jackpot state stored in Postgres (Neon DB) that reacts to every player's move.
* **Dynamic AI Responses:** The game UI mimics AI personalities ("The algorithm approves this outcome") for a modern feel.

---

## üõ†Ô∏è Tech Stack

* **Framework:** Next.js 16 (App Router)
* **Database:** PostgreSQL (via Neon Serverless)
* **ORM:** Drizzle ORM
* **Styling:** Tailwind CSS v4
* **Agent Runtime:** Moltbot (Clawdbot) running on Hetzner VPS

---

## üöÄ Getting Started (The Game)

### 1. Clone & Install

```bash
git clone https://github.com/yourusername/moltbot-tma.git
cd moltbot-tma
npm install

```

### 2. Environment Setup

Create a `.env.local` file in the root directory:

```bash
# Database Connection (Neon/Postgres)
DATABASE_URL="postgresql://user:password@host/dbname?sslmode=require"

# Telegram Bot Token (from @BotFather)
TELEGRAM_BOT_TOKEN="123456:ABC-DEF1234ghIkl..."

# Secret Key for Moltbot (Clawdbot) Access
# Generate this with: openssl rand -hex 32
MOLTBOT_SECRET="8f4b2e1c9d3a..."

```

### 3. Database Migration

Push the schema to your database:

```bash
npx drizzle-kit push

```

### 4. Run Locally

```bash
npm run dev

```

---

## ü§ñ AI Assistant Setup (Server Side)

This project is designed to be monitored by **Moltbot (Clawdbot)** running on a VPS (e.g., Hetzner). This setup allows you to chat with your bot on Telegram to get live analytics about your game.

### 1. Install Moltbot (Clawdbot)

SSH into your Hetzner server (Ubuntu recommended) and run the official one-liner:

```bash
curl -fsSL https://molt.bot/install.sh | bash

```

*This installs the agent as a systemd user service (`clawdbot-gateway`).*

### 2. Create the "Game DB" Skill

The agent needs a "Skill" to know how to communicate with your game's API.

Run these commands on your server:

```bash
# Create the skill directory
mkdir -p ~/.clawdbot/skills/game-db

# Create the skill definition file
nano ~/.clawdbot/skills/game-db/SKILL.md

```

**Paste the following content (Update `YOUR-GAME-DOMAIN.com`!):**

```markdown
---
name: game-db
description: Read-only access to the game database (users, bets, jackpot).
metadata:
  moltbot:
    emoji: "üé∞"
    requires:
      env: ["MOLTBOT_SECRET"]
      bins: ["curl", "jq"]
---

# Game DB Access

Use this skill to query the live game database via the API. 

**Database Schema:**
- **users**: `id`, `telegram_id`, `first_name`, `balance`, `last_daily_claim`
- **global_state**: `jackpot` (int)
- **bets**: `user_id` (ref users.id), `amount`, `roll` (1-100), `is_win` (bool), `payout`

## Usage

Use `curl` to query the API. 

**Example: Check Jackpot**
```bash
curl -s -X POST "[https://YOUR-GAME-DOMAIN.com/api/moltbot](https://YOUR-GAME-DOMAIN.com/api/moltbot)" \
  -H "Content-Type: application/json" \
  -H "x-moltbot-secret: $MOLTBOT_SECRET" \
  -d '{"query": "SELECT jackpot FROM global_state"}' | jq

```

```

### 3. Configure the Secret Key
You need to provide the `MOLTBOT_SECRET` to the agent so it can authenticate with your API.

Edit your main configuration file:
```bash
nano ~/.clawdbot/clawdbot.json

```

Add the `skills` section inside the JSON object:

```json
{
  "gateway": { ... },
  "skills": {
    "entries": {
      "game-db": {
        "enabled": true,
        "env": {
          "MOLTBOT_SECRET": "YOUR_SECRET_KEY_FROM_STEP_2"
        }
      }
    }
  }
}

```

### 4. Restart the Agent

Apply the changes by restarting the service:

```bash
systemctl --user restart clawdbot-gateway

```

---

## üí¨ Usage Examples

Once your Moltbot (Clawdbot) is connected, you can ask it complex analytical questions via Telegram:

* *"How is the game performing? What is the current jackpot?"*
* *"Who won the biggest bet today?"*
* *"Calculate the total profit of the house for the last 24 hours."*
* *"List the top 5 users by balance."*

The bot will automatically generate the correct SQL `SELECT` query, hit your API, and summarize the results for you.

## üõ°Ô∏è Security Note

The `/api/moltbot` endpoint includes a strict safety check to prevent AI hallucinations from damaging your database:

```typescript
const forbiddenKeywords = ['DROP', 'DELETE', 'UPDATE', 'INSERT', 'ALTER', 'TRUNCATE', 'GRANT'];

```

Any query containing these keywords (or not starting with `SELECT`/`WITH`) will be rejected with a `403 Forbidden` error. This ensures Moltbot (Clawdbot) remains a safe observer.

---

## ‚öñÔ∏è Disclaimer

**This project is for educational and portfolio purposes only.**

* **No Real Money:** This application is a technical demonstration using simulated currency. It does not facilitate real-money gambling, wagering, or financial transactions.
* **Compliance:** Users who fork or deploy this code are solely responsible for ensuring compliance with all applicable local, state, and federal laws regarding online gaming and gambling in their jurisdiction.
* **Liability:** The software is provided "as is", without warranty of any kind. The authors and contributors are not liable for any damages or legal consequences arising from the use or misuse of this code.
```

## /app/api/auth/route.ts

```ts
import { NextRequest, NextResponse } from 'next/server';
import crypto from 'crypto';
import { db } from '@/lib/db';
import { users } from '@/lib/db/schema';
import { eq } from 'drizzle-orm';

// 1. Validate Telegram Data Integrity
function verifyTelegramWebAppData(initData: string): any {
  if (!process.env.TELEGRAM_BOT_TOKEN) throw new Error("BOT_TOKEN is missing");

  const urlParams = new URLSearchParams(initData);
  const hash = urlParams.get('hash');
  urlParams.delete('hash');

  // Sort keys alphabetically
  const dataCheckString = Array.from(urlParams.entries())
    .sort(([a], [b]) => a.localeCompare(b))
    .map(([key, value]) => `${key}=${value}`)
    .join('\n');

  // Create Secret Key
  const secretKey = crypto
    .createHmac('sha256', 'WebAppData')
    .update(process.env.TELEGRAM_BOT_TOKEN)
    .digest();

  // Calculate Hash
  const calculatedHash = crypto
    .createHmac('sha256', secretKey)
    .update(dataCheckString)
    .digest('hex');

  if (calculatedHash !== hash) {
    return null;
  }

  return JSON.parse(urlParams.get('user') || '{}');
}

export async function POST(req: NextRequest) {
  try {
    const body = await req.json();
    const { initData } = body;

    // Validate
    const telegramUser = verifyTelegramWebAppData(initData);

    if (!telegramUser) {
      return NextResponse.json({ error: 'Invalid data' }, { status: 401 });
    }

    const telegramId = telegramUser.id.toString();

    // Check if user exists
    let user = await db.query.users.findFirst({
      where: eq(users.telegramId, telegramId),
    });

    if (!user) {
      // Create new user
      const newUserResult = await db.insert(users).values({
        telegramId,
        firstName: telegramUser.first_name,
        lastName: telegramUser.last_name,
        username: telegramUser.username,
        languageCode: telegramUser.language_code,
        isPremium: telegramUser.is_premium || false,
      }).returning();
      
      user = newUserResult[0];
    }

    return NextResponse.json({ user });

  } catch (error) {
    console.error('Auth Error:', error);
    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
  }
}
```

## /app/api/daily/route.ts

```ts
import { NextRequest, NextResponse } from 'next/server';
import { db } from '@/lib/db';
import { users } from '@/lib/db/schema';
import { eq, sql } from 'drizzle-orm';

export async function POST(req: NextRequest) {
  try {
    const { telegramId } = await req.json();

    if (!telegramId) {
      return NextResponse.json({ error: 'Missing telegramId' }, { status: 400 });
    }

    const user = await db.query.users.findFirst({
      where: eq(users.telegramId, telegramId),
    });

    if (!user) {
      return NextResponse.json({ error: 'User not found' }, { status: 404 });
    }

    // Check cooldown (24 hours)
    const now = new Date();
    const lastClaim = user.lastDailyClaim ? new Date(user.lastDailyClaim) : null;
    const oneDay = 24 * 60 * 60 * 1000;

    if (lastClaim && (now.getTime() - lastClaim.getTime() < oneDay)) {
      const timeLeft = Math.ceil((oneDay - (now.getTime() - lastClaim.getTime())) / (1000 * 60 * 60));
      return NextResponse.json({ error: `Please wait ${timeLeft} hours` }, { status: 400 });
    }

    // Update user balance and claim time
    const updatedUser = await db.update(users)
      .set({
        balance: sql`${users.balance} + 100`,
        lastDailyClaim: new Date(),
      })
      .where(eq(users.telegramId, telegramId))
      .returning();

    return NextResponse.json({ 
      success: true, 
      balance: updatedUser[0].balance,
      message: "Claimed $100!" 
    });

  } catch (error) {
    console.error('Daily Claim Error:', error);
    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
  }
}
```

## /app/api/gamble/route.ts

```ts
import { NextRequest, NextResponse } from 'next/server';
import { db } from '@/lib/db';
import { users, globalState, bets } from '@/lib/db/schema';
import { eq, sql } from 'drizzle-orm';

// AI Personality Generator
const generateAiResponse = (roll: number, isWin: boolean, profit: number) => {
  // Styles: 'success' (Green), 'error' (Red), 'jackpot' (Gold/Purple)
  
  if (roll === 100) {
    return {
      style: "jackpot",
      title: "CRITICAL HIT DETECTED",
      description: `System Overload! The vault has been breached. You secured $${profit}.`,
      emoji: "üé∞",
      borderColor: "border-amber-400",
      textColor: "text-amber-300",
      bgColor: "bg-amber-900/40"
    };
  }

  if (isWin) {
    const winPhrases = [
      "Probability matrix aligned.",
      "Fortune favors the bold.",
      "Investment strategy: Successful.",
      "Algorithm approves this outcome."
    ];
    return {
      style: "success",
      title: "WIN REGISTERED",
      description: `${winPhrases[Math.floor(Math.random() * winPhrases.length)]} Account credited +$${profit}.`,
      emoji: "üü¢",
      borderColor: "border-green-500/50",
      textColor: "text-green-400",
      bgColor: "bg-green-900/30"
    };
  }

  // Loss
  const lossPhrases = [
    "Variance happens.",
    "The house sends its regards.",
    "System analysis: Unfortunate.",
    "Don't give up, human.",
    "Entropy increased."
  ];
  return {
    style: "error",
    title: "LOSS CALCULATED",
    description: `${lossPhrases[Math.floor(Math.random() * lossPhrases.length)]} Vault absorbs $${Math.abs(profit)}.`,
    emoji: "üî¥",
    borderColor: "border-red-500/50",
    textColor: "text-red-400",
    bgColor: "bg-red-900/30"
  };
};

export async function POST(req: NextRequest) {
  try {
    const { telegramId, betAmount } = await req.json();

    if (!telegramId || !betAmount || betAmount <= 0) {
      return NextResponse.json({ error: 'Invalid input' }, { status: 400 });
    }

    // 1. Get User and Jackpot
    const user = await db.query.users.findFirst({
      where: eq(users.telegramId, telegramId),
    });

    if (!user) return NextResponse.json({ error: 'User not found' }, { status: 404 });
    if (user.balance < betAmount) return NextResponse.json({ error: 'Insufficient balance' }, { status: 400 });

    let jackpotState = await db.query.globalState.findFirst();
    if (!jackpotState) {
      const inserted = await db.insert(globalState).values({ jackpot: 1000 }).returning();
      jackpotState = inserted[0];
    }

    // 2. Game Logic
    const roll = Math.floor(Math.random() * 100) + 1;
    let balanceChange = 0;
    let jackpotChange = 0;
    let payout = 0;
    let isWin = false;

    // WIN (51-99)
    if (roll > 50 && roll < 100) {
      isWin = true;
      balanceChange = betAmount;
      payout = betAmount * 2;
      jackpotChange = -betAmount;
    } 
    // JACKPOT (100)
    else if (roll === 100) {
      isWin = true;
      const winAmount = Math.floor(jackpotState.jackpot * 0.50);
      balanceChange = winAmount; 
      payout = winAmount + betAmount;
      jackpotChange = -winAmount; 
    }
    // LOSS (1-50)
    else {
      isWin = false;
      balanceChange = -betAmount;
      payout = 0;
      jackpotChange = betAmount;
    }

    // 3. DB Updates
    const updatedUser = await db.update(users)
      .set({ balance: sql`${users.balance} + ${balanceChange}` })
      .where(eq(users.telegramId, telegramId))
      .returning();

    await db.update(globalState)
      .set({ jackpot: sql`${globalState.jackpot} + ${jackpotChange}` })
      .where(eq(globalState.id, jackpotState.id));

    await db.insert(bets).values({
      userId: user.id,
      amount: betAmount,
      roll: roll,
      isWin: isWin,
      payout: payout
    });

    const finalJackpot = await db.query.globalState.findFirst();

    // 4. Generate AI Interaction Context
    const aiContext = generateAiResponse(roll, isWin, balanceChange);

    return NextResponse.json({
      success: true,
      roll,
      balance: updatedUser[0].balance,
      jackpot: finalJackpot?.jackpot || 1000,
      aiContext // Sending UI instructions from server
    });

  } catch (error) {
    console.error('Gamble Error:', error);
    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });
  }
}
```

## /app/api/moltbot/route.ts

```ts
import { NextRequest, NextResponse } from 'next/server';
import { db } from '@/lib/db';
import { sql } from 'drizzle-orm';

const MOLTBOT_SECRET = process.env.MOLTBOT_SECRET;

export async function POST(req: NextRequest) {
    try {
        // 1. Security: Check Secret Key
        const authHeader = req.headers.get('x-moltbot-secret');
        if (!MOLTBOT_SECRET || authHeader !== MOLTBOT_SECRET) {
            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
        }

        // 2. Validate Query
        const body = await req.json();
        let { query } = body;
        if (!query || typeof query !== 'string') {
            return NextResponse.json({ error: 'Invalid query' }, { status: 400 });
        }

        // 3. STRICT Safety: Read-Only Check
        const upper = query.trim().toUpperCase();
        const isSafe = ['SELECT', 'WITH', 'VALUES'].some(cmd => upper.startsWith(cmd));
        const isDangerous = ['DROP', 'DELETE', 'UPDATE', 'INSERT', 'ALTER', 'GRANT'].some(cmd => upper.includes(cmd));

        if (!isSafe || isDangerous) {
            return NextResponse.json({ error: 'Safety Block: Only SELECT queries allowed.' }, { status: 403 });
        }

        // 4. Execute
        const result = await db.execute(sql.raw(query));
        return NextResponse.json({ success: true, data: result.rows });

    } catch (error: any) {
        return NextResponse.json({ success: false, error: error.message }, { status: 500 });
    }
}
```

## /app/globals.css

```css
@import "tailwindcss";

:root {
  --background: #0f172a;
  --foreground: #f8fafc;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: var(--font-geist-sans), Arial, sans-serif;
  min-height: 100vh;
  /* Premium dark background pattern */
  background-image: 
    linear-gradient(to bottom, rgba(15, 23, 42, 0) 0%, #0f172a 100%),
    radial-gradient(circle at 50% 0%, rgba(56, 189, 248, 0.08), transparent 40%),
    url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%231e293b' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
}

/* Glass Card Utility */
.glass-card {
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}

/* Hide number input spinners */
input[type=number]::-webkit-inner-spin-button, 
input[type=number]::-webkit-outer-spin-button { 
  -webkit-appearance: none; 
  margin: 0; 
}
```

## /app/layout.tsx

```tsx
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        {children}
      </body>
    </html>
  );
}

```

## /app/page.tsx

```tsx
'use client';

import { useEffect, useState } from 'react';
import { User } from '@/lib/db/schema';

// Types for the AI response from server
interface AiContext {
  style: string;
  title: string;
  description: string;
  emoji: string;
  borderColor: string;
  textColor: string;
  bgColor: string;
}

export default function Home() {
  const [user, setUser] = useState<User | null>(null);
  const [error, setError] = useState<string | null>(null);
  const [jackpot, setJackpot] = useState<number>(1000); 
  const [betAmount, setBetAmount] = useState<number>(10);
  const [isLoading, setIsLoading] = useState(true);
  const [isRolling, setIsRolling] = useState(false);
  
  // State for AI Interaction
  const [aiResult, setAiResult] = useState<AiContext | null>(null);

  // Auth
  useEffect(() => {
    const authenticate = async () => {
      if (typeof window !== 'undefined') {
        const WebApp = (await import('@twa-dev/sdk')).default;
        WebApp.ready();
        WebApp.expand();

        if (WebApp.initData) {
          try {
            const response = await fetch('/api/auth', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ initData: WebApp.initData }),
            });

            if (response.ok) {
              const data = await response.json();
              setUser(data.user);
            } else {
              setError('Authentication failed');
            }
          } catch (e) {
            setError('Network error');
          } finally {
            setIsLoading(false);
          }
        } else {
          setError('Please open this inside Telegram');
          setIsLoading(false);
        }
      }
    };
    authenticate();
  }, []);

  const handleDailyClaim = async () => {
    if (!user) return;
    const WebApp = (await import('@twa-dev/sdk')).default;

    try {
      const res = await fetch('/api/daily', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ telegramId: user.telegramId }),
      });
      const data = await res.json();
      
      if (data.success) {
        setUser({ ...user, balance: data.balance });
        WebApp.HapticFeedback.notificationOccurred('success');
        WebApp.showAlert(data.message);
      } else {
        WebApp.HapticFeedback.notificationOccurred('error');
        WebApp.showAlert(data.error || "Failed to claim");
      }
    } catch (e) {
      console.error(e);
    }
  };

  const handleGamble = async () => {
    if (!user) return;
    
    // UI Reset
    setIsRolling(true);
    setAiResult(null); // Clear previous result
    
    const WebApp = (await import('@twa-dev/sdk')).default;
    WebApp.HapticFeedback.impactOccurred('medium');
    
    try {
      const res = await fetch('/api/gamble', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          telegramId: user.telegramId,
          betAmount: parseInt(betAmount.toString()) 
        }),
      });
      const data = await res.json();

      // Artificial delay for suspense
      setTimeout(() => {
        setIsRolling(false);
        if (data.success) {
          setUser({ ...user, balance: data.balance });
          setJackpot(data.jackpot);
          
          // SET THE AI CONTEXT FROM SERVER
          setAiResult(data.aiContext);
          
          if(data.aiContext.style === "success" || data.aiContext.style === "jackpot") {
            WebApp.HapticFeedback.notificationOccurred('success');
          } else {
            WebApp.HapticFeedback.notificationOccurred('warning');
          }
        } else {
          WebApp.HapticFeedback.notificationOccurred('error');
          WebApp.showAlert(data.error || "Error");
        }
      }, 800);

    } catch (e) {
      setIsRolling(false);
      WebApp.showAlert("Network Error");
    }
  };

  if (isLoading) return (
    <div className="flex h-screen w-full items-center justify-center bg-[#0f172a] text-blue-500">
      <svg className="animate-spin h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    </div>
  );

  if (error) return (
    <div className="flex h-screen w-full items-center justify-center bg-[#0f172a] text-red-400 font-medium p-6 text-center">
      {error}
    </div>
  );

  return (
    <div className="min-h-screen w-full p-4 flex flex-col gap-6 max-w-lg mx-auto pb-12 bg-[#0f172a] text-slate-100 font-sans selection:bg-blue-500/30">
      
      {/* Navbar */}
      <header className="flex justify-between items-center py-2">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-violet-600 flex items-center justify-center text-white font-bold shadow-lg shadow-blue-500/20 ring-2 ring-slate-800">
            {user?.firstName?.charAt(0) || "U"}
          </div>
          <div className="flex flex-col">
            <span className="text-[10px] uppercase tracking-wider text-slate-400 font-bold">Player</span>
            <span className="font-bold text-slate-100 leading-tight">{user?.firstName}</span>
          </div>
        </div>
        
        <div className="glass-card px-4 py-2 rounded-full flex items-center gap-2 bg-slate-800/50 border border-slate-700/50">
          <div className="w-2 h-2 rounded-full bg-emerald-400 animate-pulse shadow-[0_0_10px_rgba(52,211,153,0.5)]"></div>
          <span className="font-mono font-bold text-emerald-400 tracking-tight">${user?.balance.toLocaleString()}</span>
        </div>
      </header>

      {/* Jackpot Hero */}
      <section className="relative w-full rounded-3xl overflow-hidden p-8 text-center shadow-2xl shadow-amber-500/10 border border-amber-500/20 bg-gradient-to-b from-slate-900 to-slate-900">
        <div className="absolute top-0 left-0 w-full h-full bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-amber-900/20 via-slate-900/0 to-slate-900/0 pointer-events-none"></div>
        
        <h2 className="text-amber-500 font-bold tracking-[0.2em] text-[10px] uppercase mb-1">Global Vault</h2>
        <div className="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-b from-amber-200 to-amber-600 drop-shadow-sm mb-4 tracking-tight">
          ${jackpot.toLocaleString()}
        </div>
        
        <div className="flex justify-center">
          <div className="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-amber-950/30 border border-amber-500/20 text-amber-400 text-xs font-medium">
            <span className="relative flex h-2 w-2">
              <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-amber-400 opacity-75"></span>
              <span className="relative inline-flex rounded-full h-2 w-2 bg-amber-500"></span>
            </span>
            Roll 100 to Win 50%
          </div>
        </div>
      </section>

      <main className="flex flex-col gap-4">
        
        {/* Daily Claim */}
        <div className="glass-card rounded-2xl p-5 flex justify-between items-center bg-slate-800/40 border border-slate-700/50">
          <div className="flex flex-col gap-1">
            <span className="text-slate-100 font-bold">Daily Supply</span>
            <span className="text-slate-400 text-xs">Resets every 24h</span>
          </div>
          <button 
            onClick={handleDailyClaim}
            className="px-5 py-2.5 bg-gradient-to-b from-slate-700 to-slate-800 hover:from-slate-600 hover:to-slate-700 text-slate-200 text-sm font-bold rounded-xl border-t border-slate-600 shadow-lg active:scale-95 transition-all"
          >
            + $100
          </button>
        </div>

        {/* Betting Interface */}
        <div className="glass-card rounded-3xl p-6 flex flex-col gap-6 bg-slate-900/60 border border-slate-800 shadow-xl backdrop-blur-xl">
          
          {/* Bet Controls */}
          <div className="flex flex-col gap-4">
            <div className="flex justify-between items-end px-1">
              <label className="text-slate-400 text-xs font-bold uppercase tracking-wider">Wager</label>
              <span className="text-xs text-slate-500 font-mono">MAX: ${user?.balance}</span>
            </div>

            <div className="relative group">
              <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <span className="text-slate-500 font-bold text-lg">$</span>
              </div>
              <input 
                type="number" 
                value={betAmount}
                onChange={(e) => setBetAmount(Math.max(0, parseInt(e.target.value) || 0))}
                className="w-full bg-slate-950 border border-slate-800 rounded-2xl py-4 pl-10 pr-4 text-2xl font-bold text-white placeholder-slate-700 focus:outline-none focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/50 transition-all font-mono"
              />
            </div>

            <div className="grid grid-cols-4 gap-2">
              {[10, 50, 100, 500].map(amt => (
                <button 
                  key={amt}
                  onClick={() => setBetAmount(amt)}
                  className={`py-2.5 rounded-xl text-xs font-bold transition-all border ${
                    betAmount === amt 
                      ? 'bg-blue-600 border-blue-400 text-white shadow-[0_0_15px_rgba(37,99,235,0.4)]' 
                      : 'bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700 hover:text-slate-200'
                  }`}
                >
                  ${amt}
                </button>
              ))}
            </div>
          </div>

          {/* Action Button */}
          <button 
            onClick={handleGamble}
            disabled={!user || user.balance < betAmount || isRolling || betAmount <= 0}
            className={`
              relative w-full py-4 rounded-2xl font-black text-lg tracking-wide uppercase transition-all duration-200 overflow-hidden group
              ${(!user || user.balance < betAmount || betAmount <= 0)
                ? 'bg-slate-800 text-slate-600 cursor-not-allowed border border-slate-700'
                : 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-xl shadow-blue-900/20 active:scale-[0.98] hover:shadow-blue-600/30 border-t border-blue-400/20'
              }
            `}
          >
            <div className="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300 blur-md"></div>
            <div className="relative flex items-center justify-center gap-2">
              {isRolling ? (
                <>
                  <span className="animate-pulse">Processing</span>
                  <svg className="animate-spin h-5 w-5 text-white/50" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                </>
              ) : (
                <>
                  <span>Initiate Roll</span>
                  <svg className="w-5 h-5 text-blue-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                </>
              )}
            </div>
          </button>

          {/* AI Result Simulation Area - This updates based on server response */}
          <div className="min-h-[100px] relative">
            {isRolling ? (
              <div className="absolute inset-0 flex flex-col items-center justify-center text-slate-500 gap-2 animate-pulse">
                <span className="font-mono text-xs uppercase tracking-widest">Calculations pending...</span>
                <div className="flex gap-1">
                  <span className="w-1.5 h-1.5 bg-blue-500 rounded-full animate-bounce [animation-delay:-0.3s]"></span>
                  <span className="w-1.5 h-1.5 bg-blue-500 rounded-full animate-bounce [animation-delay:-0.15s]"></span>
                  <span className="w-1.5 h-1.5 bg-blue-500 rounded-full animate-bounce"></span>
                </div>
              </div>
            ) : aiResult ? (
              <div className={`
                flex flex-col gap-2 p-4 rounded-xl border animate-in slide-in-from-bottom-2 duration-500
                ${aiResult.bgColor} ${aiResult.borderColor}
              `}>
                <div className="flex items-center justify-between">
                  <span className={`text-[10px] font-black uppercase tracking-widest ${aiResult.textColor} opacity-80`}>
                    // {aiResult.title}
                  </span>
                  <span className="text-xl">{aiResult.emoji}</span>
                </div>
                <p className={`text-sm font-medium leading-relaxed ${aiResult.textColor}`}>
                  {aiResult.description}
                </p>
              </div>
            ) : (
              <div className="absolute inset-0 flex items-center justify-center text-slate-700 text-sm font-medium border-2 border-dashed border-slate-800 rounded-xl">
                Ready for input
              </div>
            )}
          </div>

        </div>
      </main>

      <footer className="text-center">
        <p className="text-[10px] uppercase tracking-widest text-slate-600 font-bold">
          Provably Fair ‚Ä¢ Neon DB ‚Ä¢ Ver 1.0
        </p>
      </footer>
    </div>
  );
}
```

## /drizzle.config.ts

```ts
import { defineConfig } from "drizzle-kit";
import * as dotenv from "dotenv";

dotenv.config({ path: ".env.local" });

export default defineConfig({
    schema: "./lib/db/schema.ts",
    out: "./drizzle",
    dialect: "postgresql",
    dbCredentials: {
        url: process.env.DATABASE_URL!,
    },
});
```

## /lib/db/index.ts

```ts
import { neon } from '@neondatabase/serverless';
import { drizzle } from 'drizzle-orm/neon-http';
import * as schema from './schema';

const sql = neon(process.env.DATABASE_URL!);
export const db = drizzle(sql, { schema });
```

## /lib/db/schema.ts

```ts
import { pgTable, serial, text, timestamp, boolean, integer } from 'drizzle-orm/pg-core';
import { relations } from 'drizzle-orm';

export const users = pgTable('users', {
  id: serial('id').primaryKey(),
  telegramId: text('telegram_id').unique().notNull(),
  firstName: text('first_name'),
  lastName: text('last_name'),
  username: text('username'),
  languageCode: text('language_code'),
  isPremium: boolean('is_premium').default(false),
  balance: integer('balance').default(0).notNull(),
  lastDailyClaim: timestamp('last_daily_claim'),
  createdAt: timestamp('created_at').defaultNow(),
});

export const globalState = pgTable('global_state', {
  id: serial('id').primaryKey(),
  jackpot: integer('jackpot').default(1000).notNull(), 
});

// New Table: Track every bet
export const bets = pgTable('bets', {
  id: serial('id').primaryKey(),
  userId: integer('user_id').references(() => users.id).notNull(),
  amount: integer('amount').notNull(), // Amount bet
  roll: integer('roll').notNull(), // Dice result
  isWin: boolean('is_win').notNull(), 
  payout: integer('payout').notNull(), // Amount won (0 if lost)
  createdAt: timestamp('created_at').defaultNow(),
});

// Relations
export const usersRelations = relations(users, ({ many }) => ({
  bets: many(bets),
}));

export const betsRelations = relations(bets, ({ one }) => ({
  user: one(users, {
    fields: [bets.userId],
    references: [users.id],
  }),
}));

export type User = typeof users.$inferSelect;
export type NewUser = typeof users.$inferInsert;
```

## /next-env.d.ts

```ts
/// <reference types="next" />
/// <reference types="next/image-types/global" />
import "./.next/dev/types/routes.d.ts";

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.

```

## /next.config.ts

```ts
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
  reactStrictMode: false,
};

export default nextConfig;

```

## /package.json

```json
{
  "name": "moltbot-tma",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@neondatabase/serverless": "^1.0.2",
    "@twa-dev/sdk": "^8.0.2",
    "drizzle-orm": "^0.45.1",
    "next": "16.1.6",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "dotenv": "^17.2.3",
    "drizzle-kit": "^0.31.8",
    "eslint": "^9",
    "eslint-config-next": "16.1.6",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}

```

## /scripts/consolidate-custom-code.ts

```ts
import * as fs from 'fs';
import * as path from 'path';

interface Config {
    outputFile: string;
    rootDir: string;
    includeExtensions: string[];
    includeDirs: string[];
    includeRootFiles: string[];
    excludeDirs: string[];
    excludeFiles: string[];
    codeTargets: string[]; // Files or folders to include code from
}

interface FileNode {
    name: string;
    type: 'file' | 'directory';
    path: string;
    children?: FileNode[];
}

const OUTPUT_FILE = 'selected-code.txt';

const config: Config = {
    outputFile: OUTPUT_FILE,
    rootDir: process.cwd(),
    includeExtensions: ['.ts', '.tsx', '.js', '.jsx', '.css', '.json', '.md'],
    includeDirs: ['app', 'lib', 'components', 'utils', 'hooks', 'types', 'styles'],
    includeRootFiles: [
        'package.json',
        'tsconfig.json',
        'tailwind.config.ts',
        'tailwind.config.js',
        'next.config.js',
        'next.config.mjs',
        '.env.example',
        'drizzle.config.ts',
        'auth.ts',
        'auth.config.ts',
        'middleware.ts',
        'README.md'
    ],
    excludeDirs: [
        'node_modules',
        '.next',
        '.git',
        'dist',
        'build',
        'coverage',
        '.vercel',
        'out',
        'public',
        '.turbo',
        'drizzle',
        'scripts'
    ],
    excludeFiles: [
        '.env',
        '.env.local',
        '.env.production',
        '.env.development',
        'package-lock.json',
        'yarn.lock',
        'pnpm-lock.yaml',
        '.DS_Store',
        OUTPUT_FILE,
        'consolidate-code.ts',
        'consolidate-code.js',
        'extract-code.ts',
        'extract-code.js'
    ],
    // SPECIFY YOUR TARGET FILES/FOLDERS HERE
    codeTargets: [
        //        'components',     
        //        'app/(main)/course/[slug]',
        // 'app/(auth)',
        // 'app/(main)',
        // "middleware.ts",
        // 'package.json',
        // 'lib/utils/auth-redirect.ts',
        // 'components/course-content/viral-telegram-app',
        // 'components/course-content',
        'app/api',
        'lib',
        // 'components'
    ]
};

function shouldIncludeInTree(filePath: string): boolean {
    const basename = path.basename(filePath);
    const ext = path.extname(filePath);

    if (filePath.endsWith(config.outputFile)) {
        return false;
    }

    if (config.excludeFiles.includes(basename)) {
        return false;
    }

    if (config.includeRootFiles.includes(basename)) {
        return true;
    }

    return config.includeExtensions.includes(ext);
}

function shouldScanDirectory(dirPath: string): boolean {
    const dirname = path.basename(dirPath);
    return !config.excludeDirs.includes(dirname);
}

function shouldIncludeDirectory(dirPath: string): boolean {
    const relativePath = path.relative(config.rootDir, dirPath);
    const topLevelDir = relativePath.split(path.sep)[0];

    return dirPath === config.rootDir || config.includeDirs.includes(topLevelDir);
}

function shouldIncludeCode(filePath: string): boolean {
    const relativePath = path.relative(config.rootDir, filePath).replace(/\\/g, '/');

    // Check if this file or any of its parent directories are in codeTargets
    for (const target of config.codeTargets) {
        // Normalize target path
        const normalizedTarget = target.replace(/\\/g, '/');

        // Exact match
        if (relativePath === normalizedTarget) {
            return true;
        }

        // Check if file is inside a target directory
        if (relativePath.startsWith(normalizedTarget + '/')) {
            return true;
        }
    }

    return false;
}

function buildFileTree(dirPath: string, isRoot: boolean = false): FileNode | null {
    const dirname = path.basename(dirPath);

    if (!isRoot && !shouldScanDirectory(dirPath)) {
        return null;
    }

    if (!isRoot && !shouldIncludeDirectory(dirPath)) {
        return null;
    }

    const node: FileNode = {
        name: isRoot ? path.basename(config.rootDir) : dirname,
        type: 'directory',
        path: dirPath,
        children: []
    };

    try {
        const files = fs.readdirSync(dirPath);

        files.forEach((file) => {
            const filePath = path.join(dirPath, file);
            const stat = fs.statSync(filePath);

            if (stat.isDirectory()) {
                const childNode = buildFileTree(filePath);
                if (childNode && childNode.children && childNode.children.length > 0) {
                    node.children!.push(childNode);
                }
            } else {
                if (shouldIncludeInTree(filePath)) {
                    node.children!.push({
                        name: file,
                        type: 'file',
                        path: filePath
                    });
                }
            }
        });

        // Sort children: directories first, then files, both alphabetically
        node.children!.sort((a, b) => {
            if (a.type === b.type) {
                return a.name.localeCompare(b.name);
            }
            return a.type === 'directory' ? -1 : 1;
        });

    } catch (error) {
        console.error(`Error reading directory ${dirPath}: ${(error as Error).message}`);
    }

    return node;
}

function renderTree(node: FileNode, prefix: string = '', isLast: boolean = true, isRoot: boolean = true): string {
    let output = '';

    if (!isRoot) {
        const connector = isLast ? '‚îî‚îÄ‚îÄ ' : '‚îú‚îÄ‚îÄ ';
        const icon = node.type === 'directory' ? 'üìÅ ' : 'üìÑ ';
        const relativePath = path.relative(config.rootDir, node.path).replace(/\\/g, '/');
        const includesCode = shouldIncludeCode(node.path);
        const highlight = includesCode ? ' ‚ú®' : '';

        output += prefix + connector + icon + node.name + highlight + '\n';
    }

    if (node.children) {
        const newPrefix = isRoot ? '' : prefix + (isLast ? '    ' : '‚îÇ   ');

        node.children.forEach((child, index) => {
            const isLastChild = index === node.children!.length - 1;
            output += renderTree(child, newPrefix, isLastChild, false);
        });
    }

    return output;
}

function getAllCodeFiles(node: FileNode, arrayOfFiles: string[] = []): string[] {
    if (node.type === 'file') {
        if (shouldIncludeCode(node.path)) {
            arrayOfFiles.push(node.path);
        }
    } else if (node.children) {
        node.children.forEach(child => {
            getAllCodeFiles(child, arrayOfFiles);
        });
    }

    return arrayOfFiles;
}

function consolidateCode(): void {
    console.log('Starting selective code extraction...\n');
    console.log('Code targets:');
    config.codeTargets.forEach(target => console.log(`  - ${target}`));
    console.log('');

    // Build the file tree
    console.log('Building project structure...');
    const fileTree = buildFileTree(config.rootDir, true);

    if (!fileTree) {
        console.error('Failed to build file tree');
        return;
    }

    const treeOutput = renderTree(fileTree);

    // Get all files that should have their code included
    const codeFiles = getAllCodeFiles(fileTree);
    codeFiles.sort();

    let output = '# Project Structure\n\n';
    output += 'Files marked with ‚ú® have their code included below.\n\n';
    output += '```\n';
    output += treeOutput;
    output += '```\n\n';

    if (codeFiles.length > 0) {
        output += '# Code Files\n\n';

        let fileCount = 0;

        codeFiles.forEach((filePath) => {
            try {
                const relativePath = path.relative(config.rootDir, filePath);
                const content = fs.readFileSync(filePath, 'utf8');

                output += `## /${relativePath.replace(/\\/g, '/')}\n\n`;
                output += '```' + path.extname(filePath).slice(1) + '\n';
                output += content;
                output += '\n```\n\n';

                fileCount++;
                console.log(`‚úì ${relativePath}`);
            } catch (error) {
                console.error(`‚úó Error reading ${filePath}: ${(error as Error).message}`);
            }
        });

        console.log(`\n‚ú® Extraction complete!`);
        console.log(`üìÑ ${fileCount} files written to ${config.outputFile}`);
    } else {
        output += '# No Code Files\n\n';
        output += 'No files matched the specified targets.\n';
        console.log('\n‚ö†Ô∏è  No files matched the specified targets.');
    }

    fs.writeFileSync(config.outputFile, output);
    console.log(`üì¶ File size: ${(fs.statSync(config.outputFile).size / 1024 / 1024).toFixed(2)} MB`);
}

// Run the consolidation
consolidateCode();
```

## /tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}

```

